library(tidyquant)
install.packages("tidyquant")
library(tidyquant)
library(tidyverse)
library(timetk)
library(tibbletime)
install.packages("tibbletime")
library(tidyquant)
library(tidyverse)
library(timetk)
library(tibbletime)
library(broom)
symbols()
symbols <- c("SPY","EFA", "IJS", "EEM","AGG")
symbols
class(symbols)
?getSymbols
getSymbols(symbols, src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE, warnings = FALSE)
?getSymbols.yahoo
?getSymbols
symbols <- c("SPY","EFA", "IJS", "EEM","AGG")
prices <- getSymbols(symbols, src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE, warnings = FALSE) %>% map(~Ad(get(.))) %>% reduce(merge) %>% 'colnames<-'(symbols)
prices_monthly <- to.monthly(prices, indexAt="last", OHLC=FALSE)
head(prices)
dim(prices)
dim(prices_monthly
)
asset_returns_xts <- na.omit(Return.calculate(prices_monthly, method = "log"))
head(asset_returns_xts)
dim(asset_returns_xts)
w <- c(0.25, 0.25, 0.20, 0.20, 0.10)
portfolio_returns_xts_rebalanced_monthly <-
Return.portfolio(asset_returns_xts, weights = w, rebalance_on = "months") %>%
`colnames<-`("returns")
asset_returns_long <-
prices %>%
to.monthly(indexAt = "last", OHLC = FALSE) %>%
tk_tbl(preserve_index = TRUE, rename_index = "date") %>%
gather(asset, returns, -date) %>%
group_by(asset) %>%
mutate(returns = (log(returns) - log(lag(returns)))) %>%
na.omit()
portfolio_returns_tq_rebalanced_monthly <-
asset_returns_long %>%
tq_portfolio(assets_col  = asset,
returns_col = returns,
weights     = w,
col_rename  = "returns",
rebalance_on = "months")
library(tidyquant)
library(tidyverse)
library(timetk)
library(tibbletime)
library(broom)
symbols <- c("SPY","EFA", "IJS", "EEM","AGG")
prices <-
getSymbols(symbols, src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE, warnings = FALSE) %>%
map(~Ad(get(.))) %>%
reduce(merge) %>%
`colnames<-`(symbols)
prices_monthly <- to.monthly(prices, indexAt = "last", OHLC = FALSE)
asset_returns_xts <- na.omit(Return.calculate(prices_monthly, method = "log"))
w <- c(0.25, 0.25, 0.20, 0.20, 0.10)
portfolio_returns_xts_rebalanced_monthly <-
Return.portfolio(asset_returns_xts, weights = w, rebalance_on = "months") %>%
`colnames<-`("returns")
asset_returns_long <-
prices %>%
to.monthly(indexAt = "last", OHLC = FALSE) %>%
tk_tbl(preserve_index = TRUE, rename_index = "date") %>%
gather(asset, returns, -date) %>%
group_by(asset) %>%
mutate(returns = (log(returns) - log(lag(returns)))) %>%
na.omit()
portfolio_returns_tq_rebalanced_monthly <-
asset_returns_long %>%
tq_portfolio(assets_col  = asset,
returns_col = returns,
weights     = w,
col_rename  = "returns",
rebalance_on = "months")
market_returns_tidy <-
market_returns_xts %>% tk_tbl(preserve_index = TRUE, rename_index = "date") %>% na.omit() %>% select(date, returns = SPY)
spy_monthly_xts <-
getSymbols("SPY",
src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE,
warnings = FALSE) %>%
map(~Ad(get(.))) %>%
reduce(merge) %>%
`colnames<-`("SPY") %>%
to.monthly(indexAt = "last", OHLC = FALSE)
market_returns_xts <-
Return.calculate(spy_monthly_xts, method = "log") %>%
na.omit()
market_returns_tidy <-
market_returns_xts %>% tk_tbl(preserve_index = TRUE, rename_index = "date") %>% na.omit() %>% select(date, returns = SPY)
head(market_returns_tidy)
head(market_returns_xts)
market_returns_tidy <-
market_returns_xts %>% tk_tbl(preserve_index = TRUE, rename_index = "date") %>% na.omit() %>% select(date, returns = SPY)
head(market_returns_tidy)
portfolio_returns_tq_rebalanced_monthly %>% mutate(market_returns = market_returns_tidy$returns) %>% head()
$${\beta}_{portfolio} = cov(R_p, R_m)/\sigma_m $$
library(tidyquant)
library(tidyverse)
library(timetk)
library(tibbletime)
library(broom)
symbols <- c("SPY","EFA", "IJS", "EEM","AGG")
prices <-
getSymbols(symbols, src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE, warnings = FALSE) %>%
map(~Ad(get(.))) %>%
reduce(merge) %>%
`colnames<-`(symbols)
prices_monthly <- to.monthly(prices, indexAt = "last", OHLC = FALSE)
asset_returns_xts <- na.omit(Return.calculate(prices_monthly, method = "log"))
w <- c(0.25, 0.25, 0.20, 0.20, 0.10)
portfolio_returns_xts_rebalanced_monthly <-
Return.portfolio(asset_returns_xts, weights = w, rebalance_on = "months") %>%
`colnames<-`("returns")
asset_returns_long <-
prices %>%
to.monthly(indexAt = "last", OHLC = FALSE) %>%
tk_tbl(preserve_index = TRUE, rename_index = "date") %>%
gather(asset, returns, -date) %>%
group_by(asset) %>%
mutate(returns = (log(returns) - log(lag(returns)))) %>%
na.omit()
portfolio_returns_tq_rebalanced_monthly <-
asset_returns_long %>%
tq_portfolio(assets_col  = asset,
returns_col = returns,
weights     = w,
col_rename  = "returns",
rebalance_on = "months")
spy_monthly_xts <-
getSymbols("SPY",
src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE,
warnings = FALSE) %>%
map(~Ad(get(.))) %>%
reduce(merge) %>%
`colnames<-`("SPY") %>%
to.monthly(indexAt = "last", OHLC = FALSE)
market_returns_xts <-
Return.calculate(spy_monthly_xts, method = "log") %>%
na.omit()
market_returns_tidy <-
market_returns_xts %>% tk_tbl(preserve_index = TRUE, rename_index = "date") %>% na.omit() %>% select(date, returns = SPY)
head(market_returns_tidy)
portfolio_returns_tq_rebalanced_monthly %>% mutate(market_returns = market_returns_tidy$returns) %>% head()
Portfolio beta is equals to the covariance of the portfolio returns and market returns, divided by the variance of market returns.
Hence, our portfolio beta can be calculated as:
<code>cov(portfolio_returns_xts_rebalanced_monthly, market_returns_tidy$returns)/var(market_returns_tidy$returns)</code>
```{r}
cov(portfolio_returns_xts_rebalanced_monthly, market_returns_tidy$returns)/var(market_returns_tidy$returns)
```
cov(portfolio_returns_xts_rebalanced_monthly, market_returns_tidy$returns)/var(market_returns_tidy$returns)
?map()
?map
?rnorm
rnorm(10)
map(rnorm, n=2)
library(purrr)
library(purrr)
map(rnorm, n=2)
library(tidyverse)
map(rnorm, n=2)
1:2 %>% map(rnorm, n=2)
1:2 %>% map(rnorm, n=2) %>% map_dbl(mean)
map(rnorm, 1:2)
map(rnorm, n=2, 1)
map(n=2, rnorm)
map(2, rnorm)
?map
rnorm(10,2)
rnorm(2,2)
rnorm(2,4)
1:10 %>% map(~rnorm(10, .x))
library(dplyr)
head(iris)
head(iris%>% nest(-Species))
dim(iris)
iris%>% nest(-Species)
iris%>% nest(-Species)[1]
iris%>% nest(-Species)[[1]]
inspect(iris%>% nest(-Species))
iris%>% nest(-Species)
chickwts %>% nest(weight)
head(chickwts)
chickwts%>%unique(feed)
chickwts%>%unique()
if (require("gapminder")) {}
if (require("gapminder")) { gapminder %>% group_by(country, continent) %>% nest() gapminder %>% nest(-country, -continent) }
if (require("gapminder")) { gapminder %>% group_by(country, continent) %>% nest() gapminder %>% nest(-country, -continent) }
if (require("gapminder")) { gapminder %>% group_by(country, continent) %>% nest() gapminder %>% nest(-country, -continent) }
if (require("gapminder")) { ...gapminder %>% group_by(country, continent) %>% nest() gapminder %>% nest(-country, -continent) }
if (require("gapminder")) { gapminder %>% group_by(country, continent) %>% nest() }
head(gapminder)
gapminder %>% nest(country)
gapminder %>% nest(continent)
gapminder %>% group_by(country) %>% nest()
gapminder %>% group_by(country, continent) %>% nest()
library(tidyquant)
library(tidyverse)
library(timetk)
library(tibbletime)
library(broom)
symbols <- c("SPY","EFA", "IJS", "EEM","AGG")
prices <-
getSymbols(symbols, src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE, warnings = FALSE) %>%
map(~Ad(get(.))) %>%
reduce(merge) %>%
`colnames<-`(symbols)
prices_monthly <- to.monthly(prices, indexAt = "last", OHLC = FALSE)
asset_returns_xts <- na.omit(Return.calculate(prices_monthly, method = "log"))
w <- c(0.25, 0.25, 0.20, 0.20, 0.10)
portfolio_returns_xts_rebalanced_monthly <-
Return.portfolio(asset_returns_xts, weights = w, rebalance_on = "months") %>%
`colnames<-`("returns")
asset_returns_long <-
prices %>%
to.monthly(indexAt = "last", OHLC = FALSE) %>%
tk_tbl(preserve_index = TRUE, rename_index = "date") %>%
gather(asset, returns, -date) %>%
group_by(asset) %>%
mutate(returns = (log(returns) - log(lag(returns)))) %>%
na.omit()
portfolio_returns_tq_rebalanced_monthly <-
asset_returns_long %>%
tq_portfolio(assets_col  = asset,
returns_col = returns,
weights     = w,
col_rename  = "returns",
rebalance_on = "months")
spy_monthly_xts <-
getSymbols("SPY",
src = 'yahoo',
from = "2013-01-01",
to = "2017-12-31",
auto.assign = TRUE,
warnings = FALSE) %>%
map(~Ad(get(.))) %>%
reduce(merge) %>%
`colnames<-`("SPY") %>%
to.monthly(indexAt = "last", OHLC = FALSE)
market_returns_xts <-
Return.calculate(spy_monthly_xts, method = "log") %>%
na.omit()
market_returns_tidy <-
market_returns_xts %>% tk_tbl(preserve_index = TRUE, rename_index = "date") %>% na.omit() %>% select(date, returns = SPY)
head(market_returns_tidy)
portfolio_returns_tq_rebalanced_monthly %>% mutate(market_returns = market_returns_tidy$returns) %>% head()
cov(portfolio_returns_xts_rebalanced_monthly, market_returns_tidy$returns)/var(market_returns_tidy$returns)
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset)
beta_assets
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~ lm(returns ~ market_returns_tidy$returns, data = .)))
beta_assets
beta_assets %>%
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~ lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model = map(model, tidy))
beta_assets %>%
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~ lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model = map(model, tidy))
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~ lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model = map(model, tidy))
beta_assets
beta_assets$model
beta_assets$model[1]
beta_assets <-
asset_returns_long %>%
na.omit() %>%
mutate(model = map(data, ~ lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model = map(model, tidy)) %>%
unnest(model)
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~ lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model = map(model, tidy)) %>%
unnest(model)
beta_assets
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~ lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model = map(model, tidy))
beta_assets
beta_assets$model
beta_assets$model[1]
/lm
?lm
?estimate
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~-lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model, map(model, tidy)) %>%
unnest(model) %>%
filter(term == "market_returns_tidy$returns") %>%
select(-term)
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model, map(model, tidy)) %>%
unnest(model) %>%
filter(term == "market_returns_tidy$returns") %>%
select(-term)
beta_assets <-
asset_returns_long %>%
na.omit() %>%
nest(-asset) %>%
mutate(model = map(data, ~lm(returns ~ market_returns_tidy$returns, data = .))) %>%
mutate(model = map(model, tidy)) %>%
unnest(model) %>%
filter(term == "market_returns_tidy$returns") %>%
select(-term)
beta_assets
beta_assets %>% select(asset, estimate) %>% filter(asset == "SPY")
beta_assets
beta_assets %>% select(asset, estimate) %>% filter(asset == "SPY")
w <- c(0.25, 0.25, 0.20, 0.20, 0.10)
beta_byhand <-
w[1] * beta_assets$estimate[1] +
w[2] * beta_assets$estimate[2] +
w[3] * beta_assets$estimate[3] +
w[4] * beta_assets$estimate[4] +
w[5] * beta_assets$estimate[5]
beta_byhand
beta_auto <- cov(portfolio_returns_xts_rebalanced_monthly, market_returns_tidy$returns)/var(market_returns_tidy$returns)
beta_auto
data.frame(c(beta_auto, beta_byhand), row.names = c("auto", "byhand"))
?data.frame
